package com.example.itlog.communication;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.StringWriter;
import java.net.HttpURLConnection;
import java.net.URL;

import org.apache.http.client.ClientProtocolException;

import android.util.Log;

import com.google.gson.Gson;

public class CommunicationCenter {

	private static final String TAG = "CommunicationCenter";
	private static String BaseUrl = "";
	// public static final String LoginService = "login.php?";
	public static final String GetSessionInformationService = "getsession.php?";
	private static int timeoutConnection = 10000;

	// Interface????? DUVIDA
	public static <T> T callGetService(String NomeServico, String[] info,
			Class<T> resposta) {

		boolean isGetSession = NomeServico.equals(GetSessionInformationService);

		BufferedReader readerBuffer = null;
		HttpURLConnection connection = null;

		Gson gson = new Gson();

		int infoSize = 0;
		if (info != null) {
			infoSize = info.length;
		}

		// falta codigo aqui? ver CommunicationCenter ajuda

		StringBuilder builder = new StringBuilder(BaseUrl).append("/").append(
				NomeServico);

		if (info != null && info.length > 0) {
			if (isGetSession) {
				builder.append("username=" + info[0]).append('&')
						.append("fullname=" + info[1]).append('&')
						.append("userid=" + info[2]).append('&')
						.append("email=" + info[3]);
			}
		}

		if (isGetSession) {
			try {

				URL url = new URL(builder.toString());
				connection = (HttpURLConnection) url.openConnection();
				// connection = setConnectTimeout (timeoutConnection);
				connection.setRequestMethod("GET");
				connection.setDoInput(true);

				InputStream inputStream = null;

				if (connection instanceof HttpURLConnection) {
					HttpURLConnection httpConnection = (HttpURLConnection) connection;
					int statusCode = httpConnection.getResponseCode();
					if (statusCode != 200)
						return null;
					else
						inputStream = httpConnection.getInputStream();
				}

				readerBuffer = new BufferedReader(new InputStreamReader(
						inputStream));

				StringWriter stringWriter = new StringWriter();
				char[] buffer = new char[1024 * 4];
				int n = 0;
				while (-1 != (n = readerBuffer.read(buffer))) {
					stringWriter.write(buffer, 0, n);
				}
				
				String resultString = stringWriter.toString();

				return (T) resposta;

			} catch (ClientProtocolException e) {
				Log.e(TAG, "Got an ClientProtocolException: " + e.getMessage());
				e.printStackTrace();
				return null;
			} catch (IOException e) {
				Log.e(TAG, "Got an IOException: " + e.getMessage());
				e.printStackTrace();
				return null;
			}
		} else {
			return null;
		}

	}
}
